<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 24 NPSEM | Developer’s Guide to the tlverse</title>
<meta name="author" content="Jeremy Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.8/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.9001/transition.js"></script><script src="libs/bs3compat-0.2.5.9001/tabs.js"></script><script src="libs/bs3compat-0.2.5.9001/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
</head>
<body>
<span class="math inline">
    \(\DeclareMathOperator{\expit}{expit}\)
    \(\DeclareMathOperator{\logit}{logit}\)
    \(\DeclareMathOperator*{\argmin}{\arg\!\min}\)
    \(\newcommand{\indep}{\perp\!\!\!\perp}\)
    \(\newcommand{\coloneqq}{\mathrel{=}}\)
    \(\newcommand{\R}{\mathbb{R}}\)
    \(\newcommand{\E}{\mathbb{E}}\)
    \(\newcommand{\M}{\mathcal{M}}\)
    \(\renewcommand{\P}{\mathbb{P}}\)
    \(\newcommand{\I}{\mathbb{I}}\)
    \(\newcommand{\1}{\mathbbm{1}}\)
    </span>
    <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Developer’s Guide to the tlverse</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About this book</a></li>
<li><a class="" href="why-we-need-yet-another-targeted-learning-package.html"><span class="header-section-number">1</span> Why we need yet another Targeted Learning package</a></li>
<li><a class="" href="tlverse.html"><span class="header-section-number">2</span> Welcome to the tlverse</a></li>
<li><a class="" href="computation-graphs-with-delayed.html"><span class="header-section-number">3</span> Computation Graphs with delayed</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">4</span> Intro</a></li>
<li><a class="" href="architecture.html"><span class="header-section-number">5</span> Architecture</a></li>
<li><a class="" href="other.html"><span class="header-section-number">6</span> Other</a></li>
<li><a class="" href="previous-documentation.html"><span class="header-section-number">7</span> Previous Documentation</a></li>
<li><a class="" href="cross-validation-with-origami.html"><span class="header-section-number">8</span> Cross-validation with origami</a></li>
<li><a class="" href="intro-1.html"><span class="header-section-number">9</span> Intro</a></li>
<li><a class="" href="architecture-1.html"><span class="header-section-number">10</span> Architecture</a></li>
<li><a class="" href="other-1.html"><span class="header-section-number">11</span> Other</a></li>
<li><a class="" href="previous-documentation-1.html"><span class="header-section-number">12</span> Previous Documentation</a></li>
<li><a class="" href="super-machine-learning-with-sl3.html"><span class="header-section-number">13</span> Super (Machine) Learning with sl3</a></li>
<li><a class="" href="intro-2.html"><span class="header-section-number">14</span> Intro</a></li>
<li><a class="" href="architecture-2.html"><span class="header-section-number">15</span> Architecture</a></li>
<li><a class="" href="other-2.html"><span class="header-section-number">16</span> Other</a></li>
<li><a class="" href="previous-documentation-2.html"><span class="header-section-number">17</span> Previous Documentation</a></li>
<li><a class="" href="the-tmle-framework-with-tmle3.html"><span class="header-section-number">18</span> The TMLE Framework with tmle3</a></li>
<li><a class="" href="intro-3.html"><span class="header-section-number">19</span> Intro</a></li>
<li><a class="" href="architecture-3.html"><span class="header-section-number">20</span> Architecture</a></li>
<li><a class="" href="other-3.html"><span class="header-section-number">21</span> Other</a></li>
<li><a class="" href="previous-documentation-3.html"><span class="header-section-number">22</span> Previous documentation</a></li>
<li><a class="" href="introduction-1.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="active" href="npsem.html"><span class="header-section-number">24</span> NPSEM</a></li>
<li><a class="" href="likelihood.html"><span class="header-section-number">25</span> Likelihood</a></li>
<li><a class="" href="update-procedure.html"><span class="header-section-number">26</span> Update Procedure</a></li>
<li><a class="" href="update-procedure-1.html"><span class="header-section-number">27</span> Update Procedure</a></li>
<li><a class="" href="target-parameter.html"><span class="header-section-number">28</span> Target Parameter</a></li>
<li><a class="" href="tmle3_fit---putting-it-all-together.html"><span class="header-section-number">29</span> tmle3_Fit - Putting it all together</a></li>
<li><a class="" href="tmle-specification.html"><span class="header-section-number">30</span> TMLE Specification</a></li>
<li><a class="" href="conclusion.html"><span class="header-section-number">31</span> Conclusion</a></li>
<li><a class="" href="monte-carlo-simulation-with-tmle3sim.html"><span class="header-section-number">32</span> Monte Carlo Simulation with tmle3sim</a></li>
<li><a class="" href="intro-4.html"><span class="header-section-number">33</span> Intro</a></li>
<li><a class="" href="architecture-4.html"><span class="header-section-number">34</span> Architecture</a></li>
<li><a class="" href="other-4.html"><span class="header-section-number">35</span> Other</a></li>
<li><a class="" href="previous-documentation-4.html"><span class="header-section-number">36</span> Previous Documentation</a></li>
<li><a class="" href="highly-adaptive-lasso-with-hal9001.html"><span class="header-section-number">37</span> Highly Adaptive Lasso with hal9001</a></li>
<li><a class="" href="intro-5.html"><span class="header-section-number">38</span> Intro</a></li>
<li><a class="" href="architecture-5.html"><span class="header-section-number">39</span> Architecture</a></li>
<li><a class="" href="other-5.html"><span class="header-section-number">40</span> Other</a></li>
<li><a class="" href="previous-documentation-5.html"><span class="header-section-number">41</span> Previous Documentation</a></li>
<li><a class="" href="todo-port-documentation-from-httpsgithub.comtlversehal9001blobmastervignettesintro_hal9001.rmd.html"><span class="header-section-number">42</span> TODO: port documentation from https://github.com/tlverse/hal9001/blob/master/vignettes/intro_hal9001.Rmd</a></li>
<li><a class="" href="contributing-to-the-tlverse.html"><span class="header-section-number">43</span> Contributing to the tlverse</a></li>
<li><a class="" href="contributing-to-sl3-development.html"><span class="header-section-number">44</span> Contributing to sl3 development</a></li>
<li><a class="" href="ensuring-code-quality.html"><span class="header-section-number">45</span> Ensuring Code Quality</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tlverse/tlverse-handbook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="npsem" class="section level1" number="24">
<h1>
<span class="header-section-number">24</span> NPSEM<a class="anchor" aria-label="anchor" href="#npsem"><i class="fas fa-link"></i></a>
</h1>
<p>TMLE requires the specification of a Nonparametric Structural Equation Model
(NPSEM), which specifies our knowledge of relationships between the variables.</p>
<p>We start with a set of endogenous variables, <span class="math inline">\(X=(X_1,\ldots,X_J)\)</span>, that we want
to model the relationship between. Each <span class="math inline">\(X_j\)</span> is at least partially observed in
the dataset. The NPSEM defines each variable (<span class="math inline">\(X_j\)</span>) by a deterministic function
(<span class="math inline">\(f_{X_j}\)</span>) of its parent nodes (<span class="math inline">\(Pa(X_j)\)</span>) and an exogenous random variable
(<span class="math inline">\(U_{X_j}\)</span>):</p>
<p><span class="math display">\[X_j = f_{X_j}(Pa(X_j), U_{X_j}),\;\; j\in \{1, \ldots, J\}\]</span></p>
<p>The exact functional form of the functions <span class="math inline">\(f_{X_j}\)</span> is left unspecified at this
step. If there is <em>a priori</em> knowledge for some of these functions, that can be
specified during the likelihood step below.</p>
<div id="causal-considerations" class="section level3" number="24.0.1">
<h3>
<span class="header-section-number">24.0.1</span> Causal Considerations<a class="anchor" aria-label="anchor" href="#causal-considerations"><i class="fas fa-link"></i></a>
</h3>
<p>The collection of exogenous random variables defined by the NPSEM is
<span class="math inline">\(U = (U_{X_1}, \ldots, U_{X_J})\)</span>. Typically, non-testable assumptions about the
joint distribution of <span class="math inline">\(U\)</span> are necessary for identifiability of causal parameters
with statistical parameters of the observed data. These assumptions are not
managed in the <code>tmle3</code> framework, which instead focus on the statistical
estimation problem. Therefore, those developing tools for end users need to be
clear about the additional causal assumptions necessary for causal
interpretation of estimates.</p>
</div>
<div id="example-1" class="section level3" number="24.0.2">
<h3>
<span class="header-section-number">24.0.2</span> Example<a class="anchor" aria-label="anchor" href="#example-1"><i class="fas fa-link"></i></a>
</h3>
<p>In the case of our CPP example, we use the classic point treatment NPSEM which
defines three nodes: <span class="math inline">\(X = (W, A, Y)\)</span>, where <span class="math inline">\(W\)</span> is a set of baseline covariates,
<span class="math inline">\(A\)</span> is our exposure of interest (<code>parity01</code>), and <span class="math inline">\(Y\)</span> is our outcome of interest
(<code>haz01</code>). We define the following SCM:</p>
<p><span class="math display">\[W = f_W(U_W)\]</span>
<span class="math display">\[A = f_A(W, U_A)\]</span>
<span class="math display">\[Y = f_Y(W, U_Y)\]</span></p>
<p>In <code>tmle3</code>, this is done using the <code>define_node</code> function for each node.
<code>define_node</code> allows a user to specify the node_name, which columns in the data
comprise the node, and a list of parent nodes.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">npsem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="http://tlverse.org/tmle3/reference/tmle3_Node.html">define_node</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"apgar1"</span>, <span class="st">"apgar5"</span>, <span class="st">"gagebrth"</span>, <span class="st">"mage"</span>,
    <span class="st">"meducyrs"</span>, <span class="st">"sexn"</span>
  <span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="http://tlverse.org/tmle3/reference/tmle3_Node.html">define_node</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"parity01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"W"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="http://tlverse.org/tmle3/reference/tmle3_Node.html">define_node</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"haz01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Nodes also track information about the data types of the variables (continuous,
categorical, binomial, etc). Here, that information is being estimated
automatically from the data. In the future, each node will also contain
information about censoring indicators, where applicable, but this is not yet
implemented.</p>
</div>
<div id="tmle3_task" class="section level3" number="24.0.3">
<h3>
<span class="header-section-number">24.0.3</span> <code>tmle3_Task</code><a class="anchor" aria-label="anchor" href="#tmle3_task"><i class="fas fa-link"></i></a>
</h3>
<p>A <code>tmle3_Task</code> is an object comprised of observed data, and the NPSEM defined
above:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmle_task</span> <span class="op">&lt;-</span> <span class="va"><a href="http://tlverse.org/tmle3/reference/tmle3_Task.html">tmle3_Task</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">cpp</span>, npsem <span class="op">=</span> <span class="va">npsem</span><span class="op">)</span></code></pre></div>
<p>This task object contains methods to help subset the data as needed for various
steps in the TMLE process:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="npsem.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the outcome node data</span></span>
<span id="cb16-2"><a href="npsem.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmle_task<span class="sc">$</span><span class="fu">get_tmle_node</span>(<span class="st">"Y"</span>))</span>
<span id="cb16-3"><a href="npsem.html#cb16-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span></span>
<span id="cb16-4"><a href="npsem.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="npsem.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the sl3 task corresponding to an outcome regression</span></span>
<span id="cb16-6"><a href="npsem.html#cb16-6" aria-hidden="true" tabindex="-1"></a>tmle_task<span class="sc">$</span><span class="fu">get_regression_task</span>(<span class="st">"Y"</span>)</span>
<span id="cb16-7"><a href="npsem.html#cb16-7" aria-hidden="true" tabindex="-1"></a>A sl3 Task with <span class="dv">1441</span> obs and these nodes<span class="sc">:</span></span>
<span id="cb16-8"><a href="npsem.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="er">$</span>covariates</span>
<span id="cb16-9"><a href="npsem.html#cb16-9" aria-hidden="true" tabindex="-1"></a>         A         W1         W2         W3         W4         W5         W6 </span>
<span id="cb16-10"><a href="npsem.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="st">"parity01"</span>   <span class="st">"apgar1"</span>   <span class="st">"apgar5"</span> <span class="st">"gagebrth"</span>     <span class="st">"mage"</span> <span class="st">"meducyrs"</span>     <span class="st">"sexn"</span> </span>
<span id="cb16-11"><a href="npsem.html#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="npsem.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>outcome</span>
<span id="cb16-13"><a href="npsem.html#cb16-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"haz01"</span></span>
<span id="cb16-14"><a href="npsem.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="npsem.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>id</span>
<span id="cb16-16"><a href="npsem.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb16-17"><a href="npsem.html#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="npsem.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>weights</span>
<span id="cb16-19"><a href="npsem.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb16-20"><a href="npsem.html#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="npsem.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>offset</span>
<span id="cb16-22"><a href="npsem.html#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span>
<span id="cb16-23"><a href="npsem.html#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="npsem.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>time</span>
<span id="cb16-25"><a href="npsem.html#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span></code></pre></div>
<p>A <code>tmle3_Task</code> is a special kind of <code>sl3_Task</code> that can be used to estimate
factors of a likelihood from data. The process of defining and estimating a
likelihood is described next.</p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction-1.html"><span class="header-section-number">23</span> Introduction</a></div>
<div class="next"><a href="likelihood.html"><span class="header-section-number">25</span> Likelihood</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li>
<a class="nav-link" href="#npsem"><span class="header-section-number">24</span> NPSEM</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#causal-considerations"><span class="header-section-number">24.0.1</span> Causal Considerations</a></li>
<li><a class="nav-link" href="#example-1"><span class="header-section-number">24.0.2</span> Example</a></li>
<li><a class="nav-link" href="#tmle3_task"><span class="header-section-number">24.0.3</span> tmle3_Task</a></li>
</ul>
</li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tlverse/tlverse-handbook/blob/master/070-tmle3.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tlverse/tlverse-handbook/edit/master/070-tmle3.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Developer’s Guide to the tlverse</strong>" was written by Jeremy Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips. It was last built on September 10, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
